<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="th_create_values_used_time_off" model="ir.cron">
        <field name="name">create values used time off</field>
        <field name="model_id" ref="th_time_off.model_hr_leave"/>
        <field name="state">code</field>
        <field name="code">model.create_values_used_time_off()</field>
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>
        <field name="numbercall">1</field>
        <field eval="False" name="doall"/>
        <field name="active">True</field>
    </record>

    <!--Form view: My Time Off-->
    <record id="th_hr_leave_view_form" model="ir.ui.view">
        <field name="name">th.hr.leave.view.form</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="hr_holidays.hr_leave_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_draft']" position="attributes">
                <attribute name="groups">base.group_no_one</attribute>
            </xpath>

            <xpath expr="//button[@name='action_cancel']" position="attributes">
                <attribute name="groups">base.group_no_one</attribute>
            </xpath>

            <xpath expr="//button[@name='action_refuse']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//button[@name='action_approve']" position="after">
                <button string="Refuse" name="th_action_reason" type="object"
                        attrs="{'invisible': ['|', ('can_approve', '=', False), ('state', 'not in', ('confirm'))]}"/>
            </xpath>

            <xpath expr="//sheet/div/div/group/div[1]" position="replace">
                    <div class="o_row" attrs="{'invisible': [('request_unit_half', '=', False), ('request_unit_hours', '=', False)]}">
                        <field name="request_date_from" class="oe_inline" string="Date" attrs="{'readonly': [('state', 'not in', ('draft', 'confirm'))]}"/>
                        <field name="request_date_from_period" attrs="{'invisible': [('request_unit_half', '!=', True)], 'required': [('request_unit_half', '=', True)],
                        'readonly': [('state', 'not in', ('draft', 'confirm'))]
                        }"/>
                    </div>
            </xpath>


            <xpath expr="//sheet/div/div/group/div[2]" position="replace">
                <div class="o_row" attrs="{'invisible': ['|', ('request_unit_half', '=', True), ('request_unit_hours', '=', True)]}">
                    <span class="text-muted">From</span>
                    <field name="request_date_from" class="oe_inline"
                           attrs="{'readonly': [('state', 'not in', ('draft', 'confirm'))],
                                    'required': ['|', ('date_from', '=', False), ('date_to', '=', False)]}"
                           options="{'related_end_date': 'request_date_to'}"/>


                    <span class="text-muted">To</span>

                    <field name="request_date_to" class="oe_inline"
                           attrs="{'readonly': [('state', 'not in', ('draft', 'confirm'))],
                                    'required': ['|', ('date_from', '=', False), ('date_to', '=', False)]}"
                           options="{'related_end_date': 'request_date_from'}"/>
                </div>
            </xpath>

            <xpath expr="//field[@name='name']" position="attributes">
                    <attribute name="attrs">{'readonly': [('state', 'not in', ('draft', 'confirm'))]}</attribute>
            </xpath>

            <xpath expr="//div[hasclass('col_left')]" position="after">
                <div class="o_hr_leave_column col_right col-md-6 col-12 th_col_right"
                     style="background-color:#FCFCFC !important;">
                    <div name="col_right_st" class=""
                         attrs="{'invisible': [('holiday_type','in', ('department','company'))]}">
                        <div>
                            <field name="th_requires_allocation" invisible="1"/>
                            <b>Total number of days off:
                                <field name="th_total_leave_of_this_year" readonly="1" nolabel="1"/>
                                days
                            </b>
                            <br/>

                            <b style="padding: 0 0 5px 0 !important; display: block;"
                               attrs="{'invisible': [('th_requires_allocation', '=', False)]}">Number of day(s)
                                allocated in this year
                            </b>
                            <table attrs="{'invisible': [('th_requires_allocation', '=', False)]}">
                                <tr style="background-color:#E0E2E6;">
                                    <td style="padding: 5px 0 0 5px !important;" class="col-md-2 col-sm-2 col-2">
                                        <field name="th_holiday_status_name" style="width:50% !important" nolabel="1"/>
                                        <span style="float: right">
                                            <field name="th_allocation_number_of_days" readonly="1" nolabel="1"/>&#160;day(s)
                                        </span>
                                    </td>
                                </tr>
                            </table>

                            <b style="padding: 5px 0 !important; display: block;">This year used time off</b>
                            <field name="th_used_time_off" nolabel="1" readonly="1">
                                <tree no_open="1">
                                    <field name="th_duration_display" string=" "
                                           invisible="context.get('lang') == 'vi_VN'" nolabel="1"/>
                                    <field name="th_duration_display_vn" string=" "
                                           invisible="not (context.get('lang') == 'vi_VN')" nolabel="1"/>
                                    <field name="th_date" string=" " nolabel="1"/>
                                    <field name="th_leave_type_id" string=" " nolabel="1"/>
                                    <field name="th_employee_id" invisible="1" string=" "/>
                                </tree>
                            </field>

                            <b attrs="{'invisible': [('th_requires_allocation', '=', False)]}"
                               style="padding: 5px 0 !important;display: block;">Remaining day(s) in this
                                year
                            </b>

                            <table attrs="{'invisible': [('th_requires_allocation', '=', False)]}">
                                <tr style="background-color:#E0E2E6; width:100%">
                                    <td style="padding: 3px 0 0px 5px !important;" class="col-md-2 col-sm-2 col-2">
                                        <field name="th_holiday_status_name" style="width:50% !important" nolabel="1"/>
                                        <span style="float: right">
                                            <field name="th_remaining_number_of_days" readonly="1"/>&#160;day(s)
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <!--Menu: Time Off (when click watch)-->
    <record id="hr_holidays.hr_leave_view_form_manager" model="ir.ui.view">
        <field name="name">hr.leave.view.form.manager</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="th_time_off.th_hr_leave_view_form"/>
        <field name="mode">primary</field>
        <field name="priority">12</field>
        <field name="arch" type="xml">

            <xpath expr="//form" position="attributes">
                <attribute name="create">0</attribute>
                <attribute name="edit">0</attribute>
            </xpath>
            <xpath expr="//div[@name='title']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>
            <xpath expr="//field[@name='holiday_status_id']" position="before">
                <field name="holiday_type" string="Mode"
                    groups="hr_holidays.group_hr_holidays_user"/>
                <field name="mode_company_id" string="Company" groups="hr_holidays.group_hr_holidays_user" attrs="{
                    'required': [('holiday_type', '=', 'company')],
                    'invisible': [('holiday_type', '!=', 'company')]
                    }"/>
                <field name="category_id" groups="hr_holidays.group_hr_holidays_user" attrs="{
                    'required': [('holiday_type', '=', 'category')],
                    'invisible': [('holiday_type', '!=','category')]
                    }"/>
                <field name="department_id" groups="hr_holidays.group_hr_holidays_user" attrs="{
                    'required': [('holiday_type', '=', 'department')],
                    'invisible': [('holiday_type', '!=', 'department')]
                    }"/>
                    <field name="multi_employee" invisible="1" force_save="1"/>
                    <field name="employee_id" groups="hr_holidays.group_hr_holidays_user" attrs="{
                        'invisible': ['|', '|', ('holiday_type', '!=', 'employee'), ('state', '!=', 'validate'), ('employee_id', '=', False)]
                        }" widget="many2one_avatar_employee" class="th_zoom_avatar"/>

                 <field name="employee_ids" string="Employee" groups="hr_holidays.group_hr_holidays_user" attrs="{
                        'required': [('holiday_type', '=', 'employee'), ('state', 'in', ('draft', 'cancel', 'refuse'))],
                        'invisible': ['|','|', ('holiday_type', '!=', 'employee'), '&amp;', ('state', '=', 'validate'), ('employee_id', '!=', False), ('multi_employee','=',True)],
                        }" widget="th_many2many_avatar_employee" class="th_zoom_avatar"/>

                <field name="employee_ids" string="Employees" groups="hr_holidays.group_hr_holidays_user" attrs="{
                        'required': [('holiday_type', '=', 'employee'), ('state', 'in', ('draft', 'cancel', 'refuse'))],
                        'invisible': ['|','|', ('holiday_type', '!=', 'employee'), '&amp;', ('state', '=', 'validate'), ('employee_id', '!=', False), ('multi_employee','=',False)],
                        }" widget="th_many2many_avatar_employee" class="th_zoom_avatar"/>
            </xpath>
            <field name="name" position="replace"/>
            <field name="user_id" position="before">
                <field name="name" widget="text"/>
            </field>
            <xpath expr="//div[hasclass('oe_chatter')]" position="replace">
            </xpath>

        </field>
    </record>

    <record id="hr_holidays.hr_leave_action_action_approve_department" model="ir.actions.act_window">
        <field name="context">{'create': False,'edit': False}</field>
    </record>

    <!--Change action refuse = th_refuse kanban view-->
    <record id="th_hr_leave_view_kanban" model="ir.ui.view">
        <field name="name">th_hr_leave_view_kanban</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="hr_holidays.hr_leave_view_kanban"/>
        <field name="arch" type="xml">

            <xpath expr="//kanban//button[@name='action_refuse']" position="replace">
                <button t-if="['confirm', 'validate1'].includes(record.state.raw_value)" name="th_action_reason"
                        type="object" class="btn btn-link btn-sm pl-0">
                    <i class="fa fa-times"/>Refuse
                </button>
            </xpath>

        </field>
    </record>

</odoo>