<?xml version="1.0" encoding="utf-8"?>
<odoo>
     <!-- List view like hr_leave_view_tree. Menu: All Time Off-->
    <record id="th_hr_leave_view_tree_root" model="ir.ui.view">
    <field name="name">hr.holidays.view.tree</field>
        <field name="model">hr.leave</field>
        <field name="arch" type="xml">
            <tree string="Time Off Requests" sample="1">
                <field name="employee_id" invisible="1" />
                <field name="all_employee_ids" widget="many2many_avatar_employee" decoration-muted="not active_employee" string="Employees" />
                <field name="department_id" optional="hidden"/>
                <field name="holiday_type" string="Mode" groups="base.group_no_one"/>
                <field name="holiday_status_id" class="fw-bold"/>
                <field name="name"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="duration_display" string="Duration"/>
                <field name="state" widget="badge" decoration-info="state == 'draft'" decoration-warning="state in ('confirm','validate1')" decoration-success="state == 'validate'"/>
                <field name="active_employee" invisible="1"/>
                <field name="employee_company_id" invisible="1"/>
                <field name="category_id" invisible="1"/>
                <field name="user_id" invisible="1"/>
                <field name="message_needaction" invisible="1"/>
                <button string="Approve" name="action_approve" type="object"
                    icon="fa-thumbs-up"
                    states="confirm"
                    groups="hr_holidays.group_hr_holidays_responsible"/>
                <button string="Validate" name="action_validate" type="object"
                    icon="fa-check"
                    states="validate1"
                    groups="hr_holidays.group_hr_holidays_user"/>
                <button string="Refuse" name="action_refuse" type="object"
                    icon="fa-times"
                    states="confirm,validate1"
                    groups="hr_holidays.group_hr_holidays_user"/>
                <field name="activity_exception_decoration" widget="activity_exception"/>
            </tree>
        </field>
    </record>

     <!--List view dashboard time off-->
    <record id="th_hr_leave_view_tree_dashboard" model="ir.ui.view">
        <field name="name">hr.holidays.view.tree</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="th_time_off.th_hr_leave_view_tree_root"/>
        <field name="mode">primary</field>
        <field name="priority">32</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='employee_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='department_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='holiday_type']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='action_approve']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='action_validate']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='action_refuse']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <!-- Form view like hr_leave_view_tree. Menu: Dashboard/form-->
    <record id="th_hr_leave_view_form_dashboard" model="ir.ui.view">
        <field name="name">hr.leave.view.form</field>
        <field name="model">hr.leave</field>
        <field name="priority">32</field>
        <field name="arch" type="xml">
            <form string="Time Off Request" class="o_hr_leave_form">
            <field name="active" invisible="1"/>
            <field name="can_reset" invisible="1"/>
            <field name="can_approve" invisible="1"/>
            <field name="can_cancel" invisible="1"/>
            <field name="holiday_allocation_id" invisible="1" force_save="1"/>
            <field name="has_stress_day" invisible="1"/>
            <header>
                <button string="Confirm" name="action_confirm" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('active', '=', False)]}"/>
                <button string="Approve" name="action_approve" type="object" class="oe_highlight" attrs="{'invisible': ['|', '|', ('active', '=', False), ('can_approve', '=', False), ('state', '!=', 'confirm')]}"/>
                <button string="Validate" name="action_validate" states="validate1" type="object" groups="hr_holidays.group_hr_holidays_user" class="oe_highlight"/>
                <button string="Refuse" name="action_refuse" type="object" attrs="{'invisible': ['|', '|', ('active', '=', False), ('can_approve', '=', False), ('state', 'not in', ('confirm'))]}"/>
                <button string="Cancel" name="action_cancel" type="object" attrs="{'invisible': ['|', ('active', '=', False), ('can_cancel', '=', False)]}" />
                <button string="Mark as Draft" name="action_draft" type="object" attrs="{'invisible': ['|', ('can_reset', '=', False), ('state', 'not in', ['confirm'])]}"/>
                <field name="state" widget="statusbar" statusbar_visible="confirm,validate" attrs="{'invisible': [('active', '=', False)]}"/>
            </header>
            <sheet>
                <widget name="web_ribbon" title="Canceled" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                <div class="alert alert-info" role="alert" attrs="{'invisible': ['|', ('request_unit_hours', '=', False), '|', ('tz_mismatch', '=', False), ('holiday_type', '=', 'category')]}">
                    <span attrs="{'invisible': [('holiday_type', '!=', 'employee')]}">
                        The employee has a different timezone than yours! Here dates and times are displayed in the employee's timezone
                    </span>
                    <span attrs="{'invisible': [('holiday_type', '!=', 'department')]}">
                        The department's company has a different timezone than yours! Here dates and times are displayed in the company's timezone
                    </span>
                    <span attrs="{'invisible': [('holiday_type', '!=', 'company')]}">
                        The company has a different timezone than yours! Here dates and times are displayed in the company's timezone
                    </span>
                    (<field name="tz"/>).
                </div>
                <field name="tz_mismatch" invisible="1"/>
                <field name="holiday_type" invisible="1"/>
                <field name="leave_type_request_unit" invisible="1"/>
                <div class="o_hr_leave_content row">
                    <div class="o_hr_leave_column col_left col-md-6 col-12">
                        <div name="title" class="o_hr_leave_title" invisible="1">
                            <field name="employee_id" readonly="1" force_save="1" invisible="1"/>
                            <field name="employee_ids" invisible="1"/>
                            <field name="display_name" attrs="{'invisible': [('holiday_status_id', '=', False)]}"/>
                        </div>
                        <group name="col_left">
                            <field name="holiday_status_id" force_save="1" domain="['|', ('requires_allocation', '=', 'no'), '&amp;', ('has_valid_allocation', '=', True), '&amp;', ('virtual_remaining_leaves', '&gt;', 0), ('max_leaves', '>', '0')]" context="{'employee_id':employee_id, 'default_date_from':date_from, 'default_date_to':date_to}" options="{'no_create': True, 'no_open': True, 'request_type':'leave'}" />
                            <field name="date_from" invisible="1" />
                            <field name="date_to" invisible="1" />

                            <!-- half day or custom hours: only show one date -->
                            <label for="request_date_from" attrs="{'invisible': [('request_unit_half', '=', False), ('request_unit_hours', '=', False)]}" string="Date" />
                            <div class="o_row" attrs="{'invisible': [('request_unit_half', '=', False), ('request_unit_hours', '=', False)]}">
                                <field name="request_date_from" class="oe_inline" string="Date"
                                       attrs="{'readonly': [('state', 'not in', ('draft', 'confirm'))]}"/>
                                <field name="request_date_from_period" attrs="{'invisible': [('request_unit_half', '!=', True)], 'required': [('request_unit_half', '=', True)],
                                        'readonly': [('state', 'not in', ('draft', 'confirm'))]
                                        }"/>
                            </div>

                            <!-- full days: show date start/end with daterange -->
                            <label for="request_date_from" attrs="{'invisible': ['|', ('request_unit_half', '=', True), ('request_unit_hours', '=', True)]}" string="Dates" />
                            <div class="o_row" attrs="{'invisible': ['|', ('request_unit_half', '=', True), ('request_unit_hours', '=', True)]}">
                                <span class="text-muted">From</span>
                                <field name="request_date_from" class="oe_inline" attrs="{'readonly': [('state', 'not in', ('draft', 'confirm'))],
                                    'required': ['|', ('date_from', '=', False), ('date_to', '=', False)]
                                    }" options="{'related_end_date': 'request_date_to'}" />
                                <span class="text-muted">To</span>
                                <field name="request_date_to" class="oe_inline" attrs="{'readonly': [('state', 'not in', ('draft', 'confirm'))],
                                    'required': ['|', ('date_from', '=', False), ('date_to', '=', False)]
                                    }" options="{'related_end_date': 'request_date_from'}" />
                            </div>
                            <label for="request_unit_half" string="" attrs="{'invisible': [('leave_type_request_unit', '=', 'day')]}"/>
                            <div class="o_row o_row_readonly oe_edit_only" style="margin-left: -2px;" attrs="{'invisible': [('leave_type_request_unit', '=', 'day')]}">
                                <field name="request_unit_half" class="oe_inline" attrs="{
                                        'readonly': [('state', 'not in', ('draft', 'confirm'))],
                                        'invisible': [('leave_type_request_unit', '=', 'day')]
                                    }" />
                                <label for="request_unit_half" attrs="{
                                        'invisible': [('leave_type_request_unit', '=', 'day')]
                                    }" />
                                <field name="request_unit_hours" attrs="{
                                        'readonly': [('state', 'not in', ('draft', 'confirm'))],
                                        'invisible': [('leave_type_request_unit', '!=', 'hour')]
                                    }" class="ms-5" />
                                <label for="request_unit_hours" attrs="{
                                        'invisible': [('leave_type_request_unit', '!=', 'hour')]
                                    }" />
                            </div>
                            <label for="request_hour_from" string="" attrs="{'invisible': [('request_unit_hours', '=', False)]}"/>
                            <div class="o_row o_row_readonly" attrs="{'invisible': [('request_unit_hours', '=', False)]}">
                                <label for="request_hour_from" string="From" />
                                <field name="request_hour_from" attrs="{
                                            'readonly': [('state', '=', 'validate')],
                                            'required': [('request_unit_hours', '=', True)],
                                            'invisible': [('request_unit_hours', '=', False)]}" />
                                <label for="request_hour_to" string="To" />
                                <field name="request_hour_to" attrs="{
                                            'readonly': [('state', '=', 'validate')],
                                            'required': [('request_unit_hours', '=', True)],
                                            'invisible': [('request_unit_hours', '=', False)]}" />
                            </div>

                            <label for="number_of_days_display" string="Duration" attrs="{'invisible': [('request_unit_half', '=', True), ('leave_type_request_unit', '!=', 'hour')]}" />
                            <div name="duration_display" attrs="{'invisible': [('request_unit_half', '=', True), ('leave_type_request_unit', '!=', 'hour')]}">
                                <div attrs="{'invisible': ['|', ('request_unit_half', '=', True), ('request_unit_hours', '=', True)]}" class="o_row">
                                    <field name="number_of_days_display" class="oe_inline" />
                                    <span>Days</span>
                                </div>
                                <div attrs="{'invisible': [('leave_type_request_unit', '!=', 'hour')]}" class="o_row">
                                    <field name="number_of_hours_text" />
                                </div>
                            </div>
                            <field name="name" attrs="{'readonly': [('state', 'not in', ('draft', 'confirm'))]}" widget="text" placeholder="Add a description..." />
                            <field name="user_id" invisible="1" />
                            <field name="leave_type_support_document" invisible="1" />
                            <label for="supported_attachment_ids" string="Supporting Document" attrs="{'invisible': ['|', ('leave_type_support_document', '=', False), ('state', 'not in', ('draft', 'confirm', 'validate1'))]}" />
                            <field name="supported_attachment_ids" widget="many2many_binary" nolabel="1" attrs="{'invisible': ['|', ('leave_type_support_document', '=', False), ('state', 'not in', ('draft', 'confirm', 'validate1'))]}" />
                        </group>
                    </div>
                    <!-- Add new col_right-->
                    <div class="o_hr_leave_column col_right col-md-6 col-12 th_col_right"
                     style="background-color:#FCFCFC !important;">
                    <div name="col_right_st" class=""
                         attrs="{'invisible': [('holiday_type','in', ('department','company'))]}">
                        <div>
                            <field name="th_requires_allocation" invisible="1"/>
                            <b>Total number of days off:
                                <field name="th_total_leave_of_this_year" readonly="1" nolabel="1"/>
                                days
                            </b>
                            <br/>

                            <b style="padding: 0 0 5px 0 !important; display: block;"
                               attrs="{'invisible': [('th_requires_allocation', '=', False)]}">Number of day(s)
                                allocated in this year
                            </b>
                            <table attrs="{'invisible': [('th_requires_allocation', '=', False)]}">
                                <tr style="background-color:#E0E2E6;">
                                    <td style="padding: 5px 0 0 5px !important;" class="col-md-2 col-sm-2 col-2">
                                        <field name="th_holiday_status_name" style="width:50% !important" nolabel="1"/>
                                        <span style="float: right">
                                            <field name="th_allocation_number_of_days" readonly="1" nolabel="1"/>&#160;day(s)
                                        </span>
                                    </td>
                                </tr>
                            </table>

                            <b style="padding: 5px 0 !important; display: block;">This year used time off</b>
                            <field name="th_used_time_off" nolabel="1" readonly="1">
                                <tree no_open="1">
                                    <field name="th_duration_display" string=" "
                                           invisible="context.get('lang') == 'vi_VN'" nolabel="1"/>
                                    <field name="th_duration_display_vn" string=" "
                                           invisible="not (context.get('lang') == 'vi_VN')" nolabel="1"/>
                                    <field name="th_date" string=" " nolabel="1"/>
                                    <field name="th_leave_type_id" string=" " nolabel="1"/>
                                    <field name="th_employee_id" invisible="1" string=" "/>
                                </tree>
                            </field>

                            <b attrs="{'invisible': [('th_requires_allocation', '=', False)]}"
                               style="padding: 5px 0 !important;display: block;">Remaining day(s) in this
                                year
                            </b>

                            <table attrs="{'invisible': [('th_requires_allocation', '=', False)]}">
                                <tr style="background-color:#E0E2E6; width:100%">
                                    <td style="padding: 3px 0 0px 5px !important;" class="col-md-2 col-sm-2 col-2">
                                        <field name="th_holiday_status_name" style="width:50% !important" nolabel="1"/>
                                        <span style="float: right">
                                            <field name="th_remaining_number_of_days" readonly="1"/>&#160;day(s)
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                </div>
            </sheet>
            <div class="o_attachment_preview"/>
            <div class="oe_chatter">
                <field name="message_follower_ids"/>
                <field name="activity_ids"/>
                <field name="message_ids" options="{'post_refresh': 'always'}"/>
            </div>
            </form>
        </field>
    </record>

    <!--View form: All Time Off-->
    <record id="th_hr_leave_view_form_all" model="ir.ui.view">
        <field name="name">th.hr.leave.view.form.all</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="th_hr_leave_view_form_dashboard"/>
        <field name="mode">primary</field>
        <field name="priority">32</field>
        <field name="arch" type="xml">
            <xpath expr="//form" position="attributes">
                <attribute name="create">0</attribute>
                <attribute name="edit">1</attribute>
            </xpath>
            <xpath expr="//div[@name='title']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>
            <xpath expr="//field[@name='holiday_status_id']" position="before">
                <field name="holiday_type" string="Mode"
                    groups="hr_holidays.group_hr_holidays_user"/>
                <field name="mode_company_id" string="Company" groups="hr_holidays.group_hr_holidays_user" attrs="{
                    'required': [('holiday_type', '=', 'company')],
                    'invisible': [('holiday_type', '!=', 'company')]
                    }"/>
                <field name="category_id" groups="hr_holidays.group_hr_holidays_user" attrs="{
                    'required': [('holiday_type', '=', 'category')],
                    'invisible': [('holiday_type', '!=','category')]
                    }"/>
                <field name="department_id" groups="hr_holidays.group_hr_holidays_user" attrs="{
                    'required': [('holiday_type', '=', 'department')],
                    'invisible': [('holiday_type', '!=', 'department')]
                    }"/>
                    <field name="multi_employee" invisible="1" force_save="1"/>
                    <field name="employee_id" groups="hr_holidays.group_hr_holidays_user" attrs="{
                        'invisible': ['|', '|', ('holiday_type', '!=', 'employee'), ('state', '!=', 'validate'), ('employee_id', '=', False)]
                        }" widget="many2one_avatar_employee" class="th_zoom_avatar"/>

                 <field name="employee_ids" string="Employee" groups="hr_holidays.group_hr_holidays_user" attrs="{
                        'required': [('holiday_type', '=', 'employee'), ('state', 'in', ('draft', 'cancel', 'refuse'))],
                        'invisible': ['|','|', ('holiday_type', '!=', 'employee'), '&amp;', ('state', '=', 'validate'), ('employee_id', '!=', False), ('multi_employee','=',True)],
                        }" widget="th_many2many_avatar_employee" class="th_zoom_avatar"/>

                <field name="employee_ids" string="Employees" groups="hr_holidays.group_hr_holidays_user" attrs="{
                        'required': [('holiday_type', '=', 'employee'), ('state', 'in', ('draft', 'cancel', 'refuse'))],
                        'invisible': ['|','|', ('holiday_type', '!=', 'employee'), '&amp;', ('state', '=', 'validate'), ('employee_id', '!=', False), ('multi_employee','=',False)],
                        }" widget="th_many2many_avatar_employee" class="th_zoom_avatar"/>
            </xpath>
        </field>
    </record>

    <!-- Change 2 view:
       - List view: Time Off Dashboard
       - Form view: Time Off Dashboard
       -->
    <record id="th_hr_leave_action_new_request" model="ir.actions.act_window">
        <field name="name">Dashboard</field>
        <field name="res_model">hr.leave</field>
        <field name="view_mode">calendar,tree,form</field>
        <field name="domain">[('user_id', '=', uid), ('employee_id.company_id', 'in', allowed_company_ids)]</field>
        <field name="context">{'short_name': 1, 'search_default_active_time_off': 1}</field>
        <field name="search_view_id" ref="hr_holidays.hr_leave_view_search_my"/>
        <field name="view_ids" eval="[(5, 0, 0),
                    (0, 0, {'view_mode': 'calendar', 'view_id': ref('hr_holidays.hr_leave_view_dashboard')}),
                    (0, 0, {'view_mode': 'tree', 'view_id': ref('th_hr_leave_view_tree_dashboard')}),
                    (0, 0, {'view_mode': 'form', 'view_id': ref('th_hr_leave_view_form_dashboard')}),
                    ]"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Keep track of your PTOs.
            </p><p>
                A great way to keep track on your time off requests, sick days, and approval status.
            </p>
        </field>
    </record>

    <!-- Change 2 view:
       - List view: All Time Off
       - Form view: All Time Off
       -->
    <record id="th_hr_leave_action_action_approve_department" model="ir.actions.act_window">
        <field name="name">All Time Off</field>
        <field name="res_model">hr.leave</field>
        <field name="view_mode">tree,kanban,form,calendar</field>
        <field name="search_view_id" ref="hr_holidays.hr_leave_view_search_manager"/>
        <field name="view_ids" eval="[(5, 0, 0),
                        (0, 0, {'view_mode': 'tree', 'view_id': ref('th_hr_leave_view_tree_root')}),
                        (0, 0, {'view_mode': 'form', 'view_id': ref('th_hr_leave_view_form_all')}),
                        (0, 0, {'view_mode': 'kanban',}),
                        ]"/>
        <field name="domain">[]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Meet the time off dashboard.
            </p>
            <p>
                A great way to keep track on employeeâ€™s PTOs, sick days, and approval status.
            </p>
        </field>
    </record>

    <!-- Menu: Dashboard-->
     <record id="hr_holidays.hr_leave_menu_new_request" model="ir.ui.menu">
         <field name="action" ref="th_time_off.th_hr_leave_action_new_request"/>
     </record>

    <!-- Menu: All time off-->
    <record id="hr_holidays.menu_open_department_leave_approve" model="ir.ui.menu">
        <field name="action" ref="th_time_off.th_hr_leave_action_action_approve_department"/>
    </record>

</odoo>